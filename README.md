# MOA (ëª¨ì•„) - Backend

> **OTT êµ¬ë… ê³µìœ  í”Œë«í¼** - êµ¬ë…ë£Œë¥¼ ë‚˜ëˆ„ì–´ í•©ë¦¬ì ì¸ ê°€ê²©ìœ¼ë¡œ OTT ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì„¸ìš”

<div align="center">

![Java](https://img.shields.io/badge/Java-17-orange?style=for-the-badge&logo=openjdk)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.8-6DB33F?style=for-the-badge&logo=springboot)
![MySQL](https://img.shields.io/badge/MySQL-8.0-4479A1?style=for-the-badge&logo=mysql&logoColor=white)
![MyBatis](https://img.shields.io/badge/MyBatis-3.0.3-000000?style=for-the-badge)

</div>

---

## í”„ë¡œì íŠ¸ ì†Œê°œ

**MOA**ëŠ” Netflix, Disney+, Wavve ë“± OTT ì„œë¹„ìŠ¤ì˜ êµ¬ë…ë£Œë¥¼ ì—¬ëŸ¬ ì‚¬ìš©ìê°€ í•¨ê»˜ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **íŒŒí‹° ë§¤ì¹­ í”Œë«í¼**ì…ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥
- **íŒŒí‹° ì‹œìŠ¤í…œ**: ë°©ì¥ì´ íŒŒí‹°ë¥¼ ìƒì„±í•˜ê³  ë©¤ë²„ë¥¼ ëª¨ì§‘í•˜ì—¬ êµ¬ë…ë£Œ ë¶„ë‹´
- **ìë™ ê²°ì œ**: Toss Payments ë¹Œë§í‚¤ ê¸°ë°˜ ì›”ë³„ ìë™ ê²°ì œ
- **ì •ì‚° ì‹œìŠ¤í…œ**: ì˜¤í”ˆë±…í‚¹ API ì—°ë™ìœ¼ë¡œ ë°©ì¥ì—ê²Œ ìë™ ì •ì‚°
- **ë³´ì•ˆ ì¸ì¦**: JWT + 2FA(TOTP) + OAuth 2.0 (ì¹´ì¹´ì˜¤, êµ¬ê¸€)
- **ì‹¤ì‹œê°„ ì•Œë¦¼**: SSE ê¸°ë°˜ í‘¸ì‹œ ì•Œë¦¼ ì‹œìŠ¤í…œ
- **AI ì±—ë´‡**: OpenAI GPT ê¸°ë°˜ ê³ ê° ìƒë‹´

---

## ê¸°ìˆ  ìŠ¤íƒ

### Backend Framework
| ê¸°ìˆ  | ë²„ì „ | ì„¤ëª… |
|------|------|------|
| **Java** | 17 | LTS ë²„ì „, Record, Pattern Matching ë“± ìµœì‹  ê¸°ëŠ¥ í™œìš© |
| **Spring Boot** | 3.5.8 | ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë ˆì„ì›Œí¬ |
| **Spring Security** | 6.x | JWT ê¸°ë°˜ ì¸ì¦/ì¸ê°€ |
| **MyBatis** | 3.0.3 | SQL Mapper, ë™ì  ì¿¼ë¦¬ |

### ë°ì´í„°ë² ì´ìŠ¤
| ê¸°ìˆ  | ì„¤ëª… |
|------|------|
| **MySQL** | ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤ |
| **H2** | í…ŒìŠ¤íŠ¸ìš© ì¸ë©”ëª¨ë¦¬ DB |

### ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™
| ì„œë¹„ìŠ¤ | ìš©ë„ |
|--------|------|
| **Toss Payments** | ì¹´ë“œ ê²°ì œ, ë¹Œë§í‚¤ ì •ê¸°ê²°ì œ, í™˜ë¶ˆ |
| **Open Banking API** | ê³„ì¢Œ ì¸ì¦, 1ì› ì¸ì¦, ì •ì‚°ê¸ˆ ì†¡ê¸ˆ |
| **Kakao OAuth** | ì†Œì…œ ë¡œê·¸ì¸ |
| **Google OAuth** | ì†Œì…œ ë¡œê·¸ì¸ |
| **OpenAI API** | GPT-4o-mini ì±—ë´‡, ì„ë² ë”© |
| **Resend** | ì´ë©”ì¼ ë°œì†¡ (ì¸ì¦, ì•Œë¦¼) |

### ë³´ì•ˆ
| ê¸°ìˆ  | ì„¤ëª… |
|------|------|
| **JWT (JJWT)** | Access/Refresh Token ì¸ì¦ |
| **TOTP** | Time-based OTP (2ë‹¨ê³„ ì¸ì¦) |
| **BCrypt** | ë¹„ë°€ë²ˆí˜¸ í•´ì‹± |
| **AES-256** | ë¯¼ê° ë°ì´í„° ì•”í˜¸í™” |

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (React)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Spring Boot Application                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Controller  â”‚â”€â”€â”‚   Service    â”‚â”€â”€â”‚        DAO           â”‚   â”‚
â”‚  â”‚   (REST)     â”‚  â”‚  (Business)  â”‚  â”‚     (MyBatis)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                  â”‚                     â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    Security Layer                      â”‚       â”‚
â”‚  â”‚  JWT Filter â”‚ CORS â”‚ Authentication â”‚ Authorization   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚              â”‚
         â–¼              â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MySQL  â”‚   â”‚   Toss   â”‚   â”‚  OpenAI  â”‚   â”‚  OAuth   â”‚
    â”‚   DB    â”‚   â”‚ Payments â”‚   â”‚   API    â”‚   â”‚ Providersâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/java/com/moa/
â”œâ”€â”€ auth/                          # JWT ì¸ì¦
â”‚   â”œâ”€â”€ filter/                    # JwtAuthenticationFilter
â”‚   â”œâ”€â”€ handler/                   # ì¸ì¦ ì‹¤íŒ¨ í•¸ë“¤ëŸ¬
â”‚   â””â”€â”€ provider/                  # JwtProvider
â”‚
â”œâ”€â”€ config/                        # ì„¤ì • í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ SecurityConfig.java        # Spring Security ì„¤ì •
â”‚   â”œâ”€â”€ TossPaymentConfig.java     # ê²°ì œ ì„¤ì •
â”‚   â”œâ”€â”€ OpenBankingConfig.java     # ì˜¤í”ˆë±…í‚¹ ì„¤ì •
â”‚   â””â”€â”€ OAuthConfig.java           # OAuth ì„¤ì •
â”‚
â”œâ”€â”€ domain/                        # ì—”í‹°í‹° (37ê°œ)
â”‚   â”œâ”€â”€ User.java
â”‚   â”œâ”€â”€ Party.java
â”‚   â”œâ”€â”€ Payment.java
â”‚   â”œâ”€â”€ Settlement.java
â”‚   â””â”€â”€ enums/                     # ìƒíƒœ ì—´ê±°í˜•
â”‚
â”œâ”€â”€ dao/                           # Data Access (25ê°œ)
â”œâ”€â”€ service/                       # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (58ê°œ)
â”œâ”€â”€ web/                           # REST Controller (21ê°œ)
â”‚
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ aspect/                    # AOP ë¡œê¹…
â”‚   â”œâ”€â”€ exception/                 # ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬
â”‚   â”œâ”€â”€ event/                     # ì´ë²¤íŠ¸ í´ë˜ìŠ¤
â”‚   â””â”€â”€ util/                      # ìœ í‹¸ë¦¬í‹°
â”‚
â”œâ”€â”€ scheduler/                     # ë°°ì¹˜ ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â”œâ”€â”€ PaymentScheduler.java      # ì›”ë³„ ìë™ ê²°ì œ
â”‚   â””â”€â”€ SettlementScheduler.java   # ì›”ë³„ ì •ì‚°
â”‚
â””â”€â”€ listener/                      # ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
```

---

## ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸

### ì¸ì¦ (`/api/auth`)
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/login` | ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ |
| POST | `/login/otp-verify` | OTP 2ë‹¨ê³„ ì¸ì¦ |
| POST | `/refresh` | í† í° ê°±ì‹  |
| POST | `/otp/setup` | 2FA ì„¤ì • |
| POST | `/otp/verify` | OTP ì½”ë“œ ê²€ì¦ |

### OAuth (`/api/oauth`)
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/kakao/auth` | ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ URL |
| GET | `/kakao/callback` | ì¹´ì¹´ì˜¤ ì½œë°± |
| GET | `/google/auth` | êµ¬ê¸€ ë¡œê·¸ì¸ URL |
| POST | `/connect` | OAuth ê³„ì • ì—°ë™ |

### íŒŒí‹° (`/api/parties`)
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/` | íŒŒí‹° ëª©ë¡ (í•„í„°ë§, í˜ì´ì§•) |
| POST | `/` | íŒŒí‹° ìƒì„± |
| GET | `/{partyId}` | íŒŒí‹° ìƒì„¸ |
| POST | `/{partyId}/leader-deposit` | ë°©ì¥ ë³´ì¦ê¸ˆ ê²°ì œ |
| POST | `/{partyId}/join` | íŒŒí‹° ê°€ì… (í†µí•© ê²°ì œ) |
| DELETE | `/{partyId}/leave` | íŒŒí‹° íƒˆí‡´ |
| GET | `/my` | ë‚´ íŒŒí‹° ëª©ë¡ |

### ê²°ì œ (`/api/v1/payments`)
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/{paymentId}` | ê²°ì œ ìƒì„¸ |
| GET | `/my` | ë‚´ ê²°ì œ ë‚´ì—­ |
| GET | `/party/{partyId}` | íŒŒí‹°ë³„ ê²°ì œ ë‚´ì—­ |

### ì •ì‚° (`/api/settlements`)
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/my` | ë‚´ ì •ì‚° ë‚´ì—­ |
| GET | `/{settlementId}/details` | ì •ì‚° ìƒì„¸ |

### ì˜¤í”ˆë±…í‚¹ (`/api/openbanking`)
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/auth-url` | ì˜¤í”ˆë±…í‚¹ ì¸ì¦ URL |
| POST | `/send-verification` | 1ì› ì¸ì¦ ë°œì†¡ |
| POST | `/verify` | ê³„ì¢Œ ì¸ì¦ ì™„ë£Œ |

### í‘¸ì‹œ ì•Œë¦¼ (`/api/push`)
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/subscribe` | SSE êµ¬ë… |
| GET | `/my` | ë‚´ ì•Œë¦¼ ëª©ë¡ |
| GET | `/unread-count` | ì½ì§€ ì•Šì€ ì•Œë¦¼ ìˆ˜ |
| PATCH | `/{pushId}/read` | ì½ìŒ ì²˜ë¦¬ |

---

## í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

### 1. íŒŒí‹° ìƒëª…ì£¼ê¸°

```
[íŒŒí‹° ìƒì„±] PENDING_PAYMENT
       â”‚
       â–¼ (ë°©ì¥ ë³´ì¦ê¸ˆ ê²°ì œ)
[ë©¤ë²„ ëª¨ì§‘] RECRUITING
       â”‚
       â–¼ (ì •ì› ë„ë‹¬)
[ì´ìš© ì¤‘] ACTIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                           â”‚
       â”‚ (ë§¤ì›” ì •ê¸° ê²°ì œ)           â”‚ (ê²°ì œ ì‹¤íŒ¨ ëˆ„ì )
       â–¼                           â–¼
   [ì •ì‚° ì²˜ë¦¬]                 SUSPENDED
       â”‚                           â”‚
       â–¼                           â–¼
   [ì¢…ë£Œ] CLOSED              DISBANDED
```

### 2. ìë™ ê²°ì œ ì‹œìŠ¤í…œ (PaymentScheduler)

```java
@Scheduled(cron = "0 0 2 * * *")  // ë§¤ì¼ 02:00
public void runDailyPayments() {
    // 1. í™œì„± íŒŒí‹°ì˜ ê²°ì œì¼ í™•ì¸
    // 2. ë¹Œë§í‚¤ë¡œ Toss Payments ê²°ì œ ìš”ì²­
    // 3. ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ í ë“±ë¡ (ìµœëŒ€ 3íšŒ)
    // 4. ê²°ì œ ì˜ˆì • ì•Œë¦¼ ë°œì†¡ (D-1)
}
```

### 3. ì •ì‚° í”„ë¡œì„¸ìŠ¤

```
[ì›”ë³„ ìˆ˜ê¸ˆì•¡ ì§‘ê³„]
     â”‚
     â–¼
[ìˆ˜ìˆ˜ë£Œ ì°¨ê°] (10%)
     â”‚
     â–¼
[ì˜¤í”ˆë±…í‚¹ ì†¡ê¸ˆ]
     â”‚
     â–¼
[ë°©ì¥ ê³„ì¢Œ ì…ê¸ˆ]
```

---

## ë³´ì•ˆ êµ¬í˜„

### JWT ì¸ì¦ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€1â”€â”€â–¶â”‚ AuthService â”‚â”€â”€2â”€â”€â–¶â”‚  JwtProvider â”‚
â”‚          â”‚â—€â”€â”€4â”€â”€â”‚             â”‚â—€â”€â”€3â”€â”€â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Protected Endpoints                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ JwtAuthenticationFilter                          â”‚  â”‚
â”‚  â”‚  1. Extract token from Header/Cookie             â”‚  â”‚
â”‚  â”‚  2. Validate signature & expiration              â”‚  â”‚
â”‚  â”‚  3. Set SecurityContext                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2FA (TOTP) í”Œë¡œìš°

```
[OTP ì„¤ì •]
1. SecretGeneratorë¡œ 32ì ì‹œí¬ë¦¿ ìƒì„±
2. QR ì½”ë“œ URL ë°˜í™˜ (Google Authenticator)
3. ì‚¬ìš©ìê°€ ì•±ì—ì„œ ìŠ¤ìº”
4. 6ìë¦¬ ì½”ë“œë¡œ ê²€ì¦
5. ë°±ì—… ì½”ë“œ 10ê°œ ë°œê¸‰

[ë¡œê·¸ì¸ ì‹œ]
1. ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
2. otpRequired: true ë°˜í™˜
3. ì‚¬ìš©ìê°€ OTP ì½”ë“œ ì…ë ¥
4. TOTP ê²€ì¦ (Â±30ì´ˆ í—ˆìš©)
5. Access/Refresh Token ë°œê¸‰
```

---

## ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜

```java
// ì´ë²¤íŠ¸ ë°œí–‰
@Service
public class PaymentService {
    public void processPayment(Payment payment) {
        // ê²°ì œ ì²˜ë¦¬ ë¡œì§
        eventPublisher.publishEvent(
            new MonthlyPaymentCompletedEvent(payment)
        );
    }
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
@Component
public class PaymentEventListener {
    @EventListener
    public void onPaymentCompleted(MonthlyPaymentCompletedEvent event) {
        // í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡
        pushService.send(event.getUserId(), "ê²°ì œ ì™„ë£Œ");
    }
}
```

### ë°œí–‰ë˜ëŠ” ì´ë²¤íŠ¸
- `MonthlyPaymentCompletedEvent` - ì›”ë³„ ê²°ì œ ì™„ë£Œ
- `MonthlyPaymentFailedEvent` - ê²°ì œ ì‹¤íŒ¨
- `SettlementCompletedEvent` - ì •ì‚° ì™„ë£Œ
- `RefundCompletedEvent` - í™˜ë¶ˆ ì™„ë£Œ
- `UserDeletedEvent` - íšŒì› íƒˆí‡´

---

## AOP ë¡œê¹…

```java
@Aspect
@Component
public class LogAspect {

    // ê²°ì œ/ì •ì‚°/ë³´ì¦ê¸ˆ - íŠ¹ë³„ ë¡œê¹…
    @Around("@within(PaymentService) || @within(SettlementService)")
    public Object logFinancialOperation(ProceedingJoinPoint pjp) {
        log.info("ğŸ’° [PAYMENT] â–¶ {} ARGS: {}", methodName, maskedArgs);
        Object result = pjp.proceed();
        log.info("ğŸ’° [PAYMENT] â—€ {} OK: {}ms", methodName, elapsed);
        return result;
    }

    // ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹
    private String maskSensitiveData(String value) {
        // password, token, billingKey â†’ ***
    }
}
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ERD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USERS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ userId (PK) â”‚ password â”‚ nickname â”‚ phone â”‚ role â”‚ status      â”‚
â”‚ otpSecret   â”‚ otpEnabled â”‚ provider â”‚ ci â”‚ regDate â”‚ deleteDate â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                  â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  PARTY  â”‚       â”‚ ACCOUNT  â”‚       â”‚USER_CARD â”‚      â”‚OAUTH_ACCOUNTâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  PARTY_MEMBER  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PAYMENT â”‚       â”‚ DEPOSIT  â”‚       â”‚ SETTLEMENT â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì‹¤í–‰ ë°©ë²•

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
- Java 17+
- MySQL 8.0+
- Maven 3.8+

### í™˜ê²½ ì„¤ì •

```properties
# application-secret.properties (gitignore)
jwt.secret=your-jwt-secret-key-base64
toss.secret.api-key=test_sk_xxx
openbanking.client-secret=xxx
oauth.kakao.client-secret=xxx
oauth.google.client-secret=xxx
openai.api.key=sk-xxx
```

### ë¹Œë“œ ë° ì‹¤í–‰

```bash
# ë¹Œë“œ
mvn clean package

# ê°œë°œ í™˜ê²½ ì‹¤í–‰
java -jar target/moa-0.0.1-SNAPSHOT.war --spring.profiles.active=local

# ìš´ì˜ í™˜ê²½ ì‹¤í–‰
java -jar target/moa-0.0.1-SNAPSHOT.war --spring.profiles.active=prod
```

---

## í…ŒìŠ¤íŠ¸

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
mvn test

# íŠ¹ì • í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ì‹¤í–‰
mvn test -Dtest=PaymentServiceTest

# ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸
mvn jacoco:report
```

### í…ŒìŠ¤íŠ¸ êµ¬ì„±
- **Unit Test**: Service, DAO ë ˆì´ì–´
- **Integration Test**: Controller + Security
- **Property-based Test**: jqwik í™œìš©

---

## ì½”ë“œ í†µê³„

| ë¶„ë¥˜ | íŒŒì¼ ìˆ˜ |
|------|--------|
| Controller | 21ê°œ |
| Service | 58ê°œ |
| DAO | 25ê°œ |
| Domain/Entity | 37ê°œ |
| MyBatis Mapper | 24ê°œ |
| Config | 11ê°œ |
| **ì´í•©** | **264ê°œ** |

---

## ì£¼ìš” ê°•ì 

1. **ë³µì¡í•œ ê¸ˆìœµ ë¡œì§ êµ¬í˜„**
   - ê²°ì œ â†’ í™˜ë¶ˆ â†’ ì •ì‚°ì˜ ì™„ì „í•œ ìë™í™”
   - ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ (ìµœëŒ€ 3íšŒ, ê°„ê²© ì¦ê°€)
   - íŠ¸ëœì­ì…˜ ë¬´ê²°ì„± ë³´ì¥

2. **ë‹¤ì¸µ ë³´ì•ˆ ì‹œìŠ¤í…œ**
   - JWT + Refresh Token + 2FA(TOTP)
   - OAuth 2.0 ë‹¤ì¤‘ í”„ë¡œë°”ì´ë”
   - AES-256 ë¯¼ê° ë°ì´í„° ì•”í˜¸í™”

3. **ì™¸ë¶€ API í†µí•©**
   - Toss Payments (ê²°ì œ/ë¹Œë§)
   - Open Banking API (ê³„ì¢Œ ì¸ì¦/ì†¡ê¸ˆ)
   - OpenAI (AI ì±—ë´‡)

4. **ì´ë²¤íŠ¸ ê¸°ë°˜ ì„¤ê³„**
   - ëŠìŠ¨í•œ ê²°í•© (Loose Coupling)
   - ë¹„ë™ê¸° ì²˜ë¦¬ (Async Processing)
   - í™•ì¥ ìš©ì´ì„±

5. **ìš´ì˜ í¸ì˜ì„±**
   - AOP ê¸°ë°˜ ìƒì„¸ ë¡œê¹…
   - ë¯¼ê° ì •ë³´ ìë™ ë§ˆìŠ¤í‚¹
   - í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬

---

## ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” í•™ìŠµ ë° í¬íŠ¸í´ë¦¬ì˜¤ ëª©ì ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.

---

## íŒ€ ì •ë³´

**4Beans Team** - MOA í”„ë¡œì íŠ¸

| íŒ€ì› | ì—­í•  |
|------|------|
| ìœ¡ì£¼ì˜ | íŒ€ì¥ / ìœ ì € / ì¸ì¦ë³´ì•ˆ |
| ë°•í•œì†” | íŒŒí‹° / ê²°ì œ / AIì±—ë´‡ |
| ê¹€ì§„ì› | êµ¬ë…ìƒí’ˆ / AWS ì¸í”„ë¼ |
| ê¹€ì´ì„œ | **ì»¤ë®¤ë‹ˆí‹° / Push ì•Œë¦¼ ì‹œìŠ¤í…œ / DB ì„¤ê³„** |

---

## íŒ€ì›ë³„ ìƒì„¸ ì—­í• 

### ê¹€ì´ì„œ - ì»¤ë®¤ë‹ˆí‹° / Push ì•Œë¦¼ ì‹œìŠ¤í…œ / DB ì„¤ê³„

#### 1. DB ì„¤ê³„ ë° ë°ì´í„° ê´€ë¦¬
| í•­ëª© | ìƒì„¸ ë‚´ìš© |
|------|-----------|
| **ERD ì„¤ê³„** | ë„ë©”ì¸ ê¸°ë°˜ ERD ì„¤ê³„ ë…¼ì˜ ì°¸ì—¬ ë° í…Œì´ë¸” êµ¬ì¡° ì •ì˜ |
| **ìƒ˜í”Œ ë°ì´í„°** | í…ŒìŠ¤íŠ¸ìš© ì‹œë“œ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (ì‚¬ìš©ì 50ëª…, êµ¬ë…/ê²°ì œ/ë¬¸ì˜ ë“± 500+ê±´) |
| **ì¸ë±ìŠ¤ ì„¤ê³„** | ì¿¼ë¦¬ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ì¸ë±ìŠ¤ ì„¤ê³„ ê¸°ì¤€ ìˆ˜ë¦½ |
| **ë²„ì „ ê´€ë¦¬** | DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì´ë ¥ Git ê¸°ë°˜ ë²„ì „ ê´€ë¦¬ |

#### 2. ì»¤ë®¤ë‹ˆí‹° ë„ë©”ì¸ (ê³µì§€/FAQ/ë¬¸ì˜) - Full Stack
| ê¸°ëŠ¥ | ìƒì„¸ êµ¬í˜„ |
|------|-----------|
| **ê³µì§€ì‚¬í•­** | CRUD, ê²€ìƒ‰/í•„í„°, í˜ì´ì§•, ê´€ë¦¬ì ë“±ë¡/ìˆ˜ì • |
| **FAQ** | ì¹´í…Œê³ ë¦¬ë³„ ì¡°íšŒ, ê²€ìƒ‰, ê´€ë¦¬ì CRUD |
| **1:1 ë¬¸ì˜** | ë“±ë¡/ìˆ˜ì •/ì‚­ì œ, íŒŒì¼ ì²¨ë¶€, ê´€ë¦¬ì ë‹µë³€ ì‹œìŠ¤í…œ |
| **ê¶Œí•œ ë¶„ê¸°** | JWT ê¸°ë°˜ ì‚¬ìš©ì/ê´€ë¦¬ì ê¶Œí•œì— ë”°ë¥¸ í™”ë©´ ë° ê¸°ëŠ¥ ë¶„ê¸° ì²˜ë¦¬ |

#### 3. Push ì•Œë¦¼ ì‹œìŠ¤í…œ - **ì „ë‹´ ì„¤ê³„/êµ¬í˜„** (Full Stack)

> **Push ì•Œë¦¼ 25ì¢…** ì „ì²´ ë¡œì§ ì„¤ê³„, ë°±ì—”ë“œ êµ¬í˜„, í”„ë¡ íŠ¸ì—”ë“œ UIê¹Œì§€ ì „ë‹´ ê°œë°œ

**Backend êµ¬í˜„ - SSE ê¸°ë°˜ ì‹¤ì‹œê°„ ì•Œë¦¼**
```java
// SSE ê¸°ë°˜ ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ
@Service
public class NotificationService {
    // ConcurrentHashMapìœ¼ë¡œ ì‚¬ìš©ìë³„ SSE ì—°ê²° ê´€ë¦¬
    private final Map<Long, SseEmitter> emitters = new ConcurrentHashMap<>();

    // ì‹¤ì‹œê°„ ì•Œë¦¼ ì „ì†¡
    public void sendNotification(Long userId, NotificationDto notification) {
        SseEmitter emitter = emitters.get(userId);
        if (emitter != null) {
            emitter.send(notification);
        }
    }
}

// íŠ¸ëœì­ì…˜ ì»¤ë°‹ í›„ ì•Œë¦¼ ë°œì†¡ (ë°ì´í„° ì •í•©ì„± ë³´ì¥)
TransactionSynchronizationManager.registerSynchronization(
    new TransactionSynchronization() {
        @Override
        public void afterCommit() {
            notificationService.sendNotification(userId, notification);
        }
    }
);
```

**Push ì•Œë¦¼ 25ì¢… ì´ë²¤íŠ¸**
| ì¹´í…Œê³ ë¦¬ | ì•Œë¦¼ ì¢…ë¥˜ |
|----------|-----------|
| **ê²°ì œ** | ê²°ì œ ì„±ê³µ, ê²°ì œ ì‹¤íŒ¨, ê²°ì œ ì¬ì‹œë„, ê²°ì œ ì˜ˆì • |
| **ì •ì‚°** | ì •ì‚° ì™„ë£Œ, ì •ì‚° ëŒ€ê¸°, ê³„ì¢Œ ë“±ë¡ ìš”ì²­ |
| **íŒŒí‹°** | íŒŒí‹° ê°€ì…, íŒŒí‹° íƒˆí‡´, íŒŒí‹° í•´ì‚°, íŒŒí‹° ì¼ì‹œì •ì§€ |
| **ë³´ì¦ê¸ˆ** | ë³´ì¦ê¸ˆ ê²°ì œ, ë³´ì¦ê¸ˆ í™˜ë¶ˆ, ë³´ì¦ê¸ˆ ì°¨ê° |
| **ë¬¸ì˜** | ë¬¸ì˜ ë“±ë¡, ë‹µë³€ ì™„ë£Œ |
| **ê³µì§€** | ìƒˆ ê³µì§€ì‚¬í•­ |
| **ê¸°íƒ€** | íšŒì›ê°€ì… í™˜ì˜, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë“± |

**Frontend êµ¬í˜„**
- SSE ì—°ê²° ê´€ë¦¬ ë° ìë™ ì¬ì—°ê²° ë¡œì§
- ì‹¤ì‹œê°„ ì•Œë¦¼ í† ìŠ¤íŠ¸ UI
- ì•Œë¦¼ ëª©ë¡ í˜ì´ì§€ (ì½ìŒ/ì•ˆì½ìŒ ì²˜ë¦¬)
- ì•Œë¦¼ ì„¤ì • (ì•Œë¦¼ ì¢…ë¥˜ë³„ ON/OFF)

#### 4. API í…ŒìŠ¤íŠ¸
| ë„êµ¬ | í™œìš© |
|------|------|
| **JUnit** | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (Service, DAO ê³„ì¸µ) |
| **Postman** | REST API ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ |

#### ê¸°ìˆ ì  ì±Œë¦°ì§€
- **SSE ì—°ê²° ê´€ë¦¬**: ì„œë²„ ì¬ì‹œì‘/ë„¤íŠ¸ì›Œí¬ ëŠê¹€ ì‹œ ìë™ ì¬ì—°ê²° êµ¬í˜„
- **íŠ¸ëœì­ì…˜ ë™ê¸°í™”**: `TransactionSynchronization` í™œìš©í•˜ì—¬ DB ì»¤ë°‹ í›„ ì•Œë¦¼ ë°œì†¡
- **ë™ì‹œì„± ì²˜ë¦¬**: `ConcurrentHashMap`ìœ¼ë¡œ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì „í•œ ì—°ê²° ê´€ë¦¬

