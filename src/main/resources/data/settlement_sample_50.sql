-- ============================================
-- SETTLEMENT 더미 데이터 생성 (최대 5건)
-- ============================================

INSERT INTO SETTLEMENT (
    PARTY_ID,
    PARTY_LEADER_ID,
    ACCOUNT_ID,
    SETTLEMENT_MONTH,
    TOTAL_AMOUNT,
    COMMISSION_AMOUNT,
    NET_AMOUNT,
    SETTLEMENT_STATUS,
    SETTLEMENT_DATE,
    BANK_TRAN_ID
)
SELECT
    p.PARTY_ID,
    p.PARTY_LEADER_ID,
    p.ACCOUNT_ID,

    DATE_FORMAT(p.START_DATE, '%Y-%m') AS SETTLEMENT_MONTH,

    p.MONTHLY_FEE AS TOTAL_AMOUNT,

    FLOOR(p.MONTHLY_FEE * 0.15) AS COMMISSION_AMOUNT,

    p.MONTHLY_FEE - FLOOR(p.MONTHLY_FEE * 0.15) AS NET_AMOUNT,

    'COMPLETED' AS SETTLEMENT_STATUS,

    DATE_ADD(p.START_DATE, INTERVAL 1 MONTH) AS SETTLEMENT_DATE,

    CONCAT(
        'T',
        DATE_FORMAT(DATE_ADD(p.START_DATE, INTERVAL 1 MONTH), '%Y%m%d'),
        LPAD(p.PARTY_ID, 4, '0')
    ) AS BANK_TRAN_ID
FROM PARTY p
WHERE p.PARTY_STATUS = 'ACTIVE'
  AND p.ACCOUNT_ID IS NOT NULL
  AND NOT EXISTS (
      SELECT 1
      FROM SETTLEMENT s
      WHERE s.PARTY_ID = p.PARTY_ID
        AND s.SETTLEMENT_MONTH = DATE_FORMAT(p.START_DATE, '%Y-%m')
  )
ORDER BY p.PARTY_ID
LIMIT 5;
