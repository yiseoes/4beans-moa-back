<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.moa.dao.product.ProductDao">

    <resultMap id="productResultMap" type="Product">
        <result property="productId" column="PRODUCT_ID"/>
        <result property="categoryId" column="CATEGORY_ID"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <result property="productStatus" column="PRODUCT_STATUS"/>
        <result property="price" column="PRICE"/>
        <result property="image" column="IMAGE"/>
        <result property="categoryName" column="CATEGORY_NAME"/>
    </resultMap>

    <insert id="addProduct" parameterType="Product" useGeneratedKeys="true" keyProperty="productId">
        INSERT INTO PRODUCT (CATEGORY_ID, PRODUCT_NAME, PRODUCT_STATUS, PRICE, IMAGE)
        VALUES (#{categoryId}, #{productName}, #{productStatus}, #{price}, #{image})
    </insert>

    <select id="getProduct" parameterType="int" resultMap="productResultMap">
        SELECT p.PRODUCT_ID, p.CATEGORY_ID, p.PRODUCT_NAME, p.PRODUCT_STATUS, p.PRICE, p.IMAGE, c.CATEGORY_NAME
        FROM PRODUCT p
        LEFT JOIN CATEGORY c ON p.CATEGORY_ID = c.CATEGORY_ID
        WHERE p.PRODUCT_ID = #{productId}
    </select>

    <select id="getProductList" resultMap="productResultMap">
SELECT     p.PRODUCT_ID,     p.CATEGORY_ID,     p.PRODUCT_NAME,     p.PRODUCT_STATUS,     p.PRICE,     p.IMAGE,     c.CATEGORY_NAME
FROM PRODUCT p
LEFT JOIN CATEGORY c ON p.CATEGORY_ID = c.CATEGORY_ID
ORDER BY     
	 p.CATEGORY_ID,
    SUBSTRING_INDEX(p.PRODUCT_NAME, ' ', 1),   -- 서비스명(Netflix) 정렬
    p.PRICE ASC;  
    </select>

    <update id="updateProduct" parameterType="Product">
        UPDATE PRODUCT
        SET CATEGORY_ID = #{categoryId},
            PRODUCT_NAME = #{productName},
            PRODUCT_STATUS = #{productStatus},
            PRICE = #{price},
            IMAGE = #{image}
        WHERE PRODUCT_ID = #{productId}
    </update>

    <delete id="deleteProduct" parameterType="int">
        DELETE FROM PRODUCT
        WHERE PRODUCT_ID = #{productId}
    </delete>

    <select id="getCategoryList" resultMap="productResultMap">
        SELECT CATEGORY_ID, CATEGORY_NAME
        FROM CATEGORY
        ORDER BY CATEGORY_ID ASC
    </select>

</mapper>
